# Code_alpha_Tasks
Simple E-commerce store
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StellarTech Store</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .product-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            transition: background-color 0.15s;
        }
        .btn-primary:hover {
            background-color: #3b82f6;
        }
        .cart-item-list {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen">
        <!-- Load Firebase & Auth setup -->
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
            import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
            import { getFirestore, collection, doc, setDoc, getDocs, onSnapshot, query, addDoc, updateDoc, deleteDoc, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
            import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

            setLogLevel('debug'); // Enable Firestore logging

            // Global variables must be declared in the window object to be accessed by other scripts
            window.initializeApp = initializeApp;
            window.getAuth = getAuth;
            window.signInAnonymously = signInAnonymously;
            window.signInWithCustomToken = signInWithCustomToken;
            window.onAuthStateChanged = onAuthStateChanged;
            window.getFirestore = getFirestore;
            window.collection = collection;
            window.doc = doc;
            window.setDoc = setDoc;
            window.getDocs = getDocs;
            window.onSnapshot = onSnapshot;
            window.query = query;
            window.addDoc = addDoc;
            window.updateDoc = updateDoc;
            window.deleteDoc = deleteDoc;
            window.where = where; // <-- FIX: Added missing where function
            
            // --- FIREBASE INITIALIZATION & AUTH ---
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
            const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

            if (Object.keys(firebaseConfig).length === 0) {
                console.error("Firebase config is missing. The app will not function correctly without Firestore.");
            }

            let app;
            let db;
            let auth;
            window.userId = null;
            window.isAuthReady = false;

            const setupFirebase = async () => {
                try {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    window.db = db;
                    window.auth = auth;

                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }

                    onAuthStateChanged(auth, (user) => {
                        if (user) {
                            window.userId = user.uid;
                        } else {
                            window.userId = `anon-${crypto.randomUUID()}`; // Fallback for anonymous user
                        }
                        window.isAuthReady = true;
                        console.log("Auth State Changed. User ID:", window.userId);
                        // Trigger the main application logic once auth is ready
                        if (window.initApp) {
                            window.initApp();
                        }
                    });

                } catch (error) {
                    console.error("Error setting up Firebase:", error);
                    window.isAuthReady = true; // Still mark as ready to prevent infinite loading
                    window.userId = `error-${crypto.randomUUID()}`;
                    if (window.initApp) {
                        window.initApp();
                    }
                }
            };
            
            setupFirebase();
            
            // --- FIRESTORE UTILITIES ---
            // Private data path for the user's cart
            window.getCartPath = () => `artifacts/${appId}/users/${window.userId}/cart_items`;

            // Public data path for product catalog
            window.getProductsPath = () => `artifacts/${appId}/public/data/products`;

        </script>

        <!-- Main Content Area -->
        <header class="bg-white shadow-md sticky top-0 z-10">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <h1 class="text-3xl font-bold text-indigo-700">StellarTech Store</h1>
                <div class="flex items-center space-x-4">
                    <span id="user-id-display" class="text-sm text-gray-500 hidden sm:inline"></span>
                    <!-- Cart Button (Modal Trigger) -->
                    <button id="cart-btn" class="relative p-2 rounded-full bg-indigo-500 text-white hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                        <span id="cart-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">0</span>
                    </button>
                </div>
            </div>
        </header>

        <main class="container mx-auto px-4 py-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Our Latest Gadgets</h2>
            <div id="loading-indicator" class="text-center text-lg text-gray-500 p-10">Loading products...</div>
            <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <!-- Product Cards will be injected here -->
            </div>
            <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mt-8" role="alert">
                <strong class="font-bold">Error:</strong>
                <span id="error-text" class="block sm:inline"> Could not load data or perform operation. Please check the console for details.</span>
            </div>
        </main>
    </div>

    <!-- Cart Modal -->
    <div id="cart-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden z-50 transition-opacity duration-300 items-center justify-center">
        <div class="bg-white w-full max-w-lg mx-4 p-6 rounded-xl shadow-2xl transform transition-transform duration-300 scale-95 opacity-0" id="cart-dialog">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 class="text-2xl font-semibold text-gray-800">Your Shopping Cart</h3>
                <button id="close-cart-btn" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div id="cart-items-container" class="py-4 cart-item-list">
                <!-- Cart items will be rendered here -->
            </div>
            
            <div class="pt-4 border-t">
                <div class="flex justify-between items-center text-xl font-bold text-gray-800 mb-4">
                    <span>Total:</span>
                    <span id="cart-total">$0.00</span>
                </div>
                <button id="checkout-btn" class="w-full btn-primary bg-green-600 text-white p-3 rounded-lg font-semibold shadow-lg hover:bg-green-700 disabled:bg-gray-400" disabled>
                    Proceed to Checkout
                </button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal (for Checkout) -->
    <div id="confirmation-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden z-50 transition-opacity duration-300 items-center justify-center">
        <div class="bg-white w-full max-w-sm mx-4 p-6 rounded-xl shadow-2xl transform transition-transform duration-300 scale-95 opacity-0" id="confirmation-dialog">
            <h3 class="text-xl font-bold text-green-600 mb-4">Order Successful!</h3>
            <p class="text-gray-600 mb-6">Your order has been placed. A confirmation email has been sent to your simulated address.</p>
            <button id="close-confirmation-btn" class="w-full btn-primary bg-indigo-600 text-white p-3 rounded-lg font-semibold hover:bg-indigo-700">
                Continue Shopping
            </button>
        </div>
    </div>

    <script>
        // Use an IIFE for encapsulation
        (function() {
            let products = [];
            let cartItems = [];

            const elements = {
                loadingIndicator: document.getElementById('loading-indicator'),
                productList: document.getElementById('product-list'),
                cartCount: document.getElementById('cart-count'),
                cartModal: document.getElementById('cart-modal'),
                cartDialog: document.getElementById('cart-dialog'),
                cartBtn: document.getElementById('cart-btn'),
                closeCartBtn: document.getElementById('close-cart-btn'),
                cartItemsContainer: document.getElementById('cart-items-container'),
                cartTotal: document.getElementById('cart-total'),
                checkoutBtn: document.getElementById('checkout-btn'),
                confirmationModal: document.getElementById('confirmation-modal'),
                confirmationDialog: document.getElementById('confirmation-dialog'),
                closeConfirmationBtn: document.getElementById('close-confirmation-btn'),
                errorText: document.getElementById('error-text'),
                errorMessage: document.getElementById('error-message'),
                userIdDisplay: document.getElementById('user-id-display')
            };

            // --- UI/MODAL HANDLERS ---
            const openModal = (modal, dialog) => {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    dialog.classList.remove('scale-95', 'opacity-0');
                }, 10);
            };

            const closeModal = (modal, dialog) => {
                modal.classList.add('opacity-0');
                dialog.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    modal.classList.remove('flex');
                    modal.classList.add('hidden');
                }, 300);
            };

            const showCartModal = () => {
                renderCart();
                openModal(elements.cartModal, elements.cartDialog);
            };

            const hideCartModal = () => {
                closeModal(elements.cartModal, elements.cartDialog);
            };

            const showConfirmationModal = () => {
                openModal(elements.confirmationModal, elements.confirmationDialog);
            };

            const hideConfirmationModal = () => {
                closeModal(elements.confirmationModal, elements.confirmationDialog);
            };

            const showError = (message) => {
                elements.errorText.textContent = message;
                elements.errorMessage.classList.remove('hidden');
                console.error("Application Error:", message);
            }

            // --- RENDERING FUNCTIONS ---

            const formatCurrency = (amount) => `$${amount.toFixed(2)}`;

            const renderProducts = () => {
                if (products.length === 0) {
                    elements.loadingIndicator.textContent = "No products found. Seeding initial data...";
                    return;
                }
                elements.loadingIndicator.classList.add('hidden');
                elements.productList.innerHTML = products.map(product => `
                    <div class="product-card bg-white rounded-xl shadow-lg overflow-hidden flex flex-col justify-between p-5 border border-gray-100" data-id="${product.id}">
                        <!-- Placeholder Image -->
                        <img src="https://placehold.co/400x300/a3e635/16a34a?text=${encodeURIComponent(product.name)}" 
                             alt="${product.name}" 
                             class="w-full h-48 object-cover rounded-lg mb-4" />
                        
                        <h3 class="text-xl font-bold text-gray-900 mb-2">${product.name}</h3>
                        <p class="text-gray-600 text-sm mb-4 line-clamp-2">${product.description}</p>
                        
                        <div class="flex justify-between items-center mt-auto">
                            <span class="text-2xl font-extrabold text-indigo-600">${formatCurrency(product.price)}</span>
                            <button class="add-to-cart-btn btn-primary bg-indigo-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-600"
                                    data-id="${product.id}">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                `).join('');
                attachProductListeners();
            };

            const renderCart = () => {
                elements.cartItemsContainer.innerHTML = '';
                let total = 0;
                
                if (cartItems.length === 0) {
                    elements.cartItemsContainer.innerHTML = `
                        <p class="text-center text-gray-500 py-10">Your cart is empty. Time to start shopping!</p>
                    `;
                    elements.checkoutBtn.disabled = true;
                } else {
                    cartItems.forEach(item => {
                        const itemTotal = item.price * item.quantity;
                        total += itemTotal;
                        
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'flex items-center justify-between border-b py-3 last:border-b-0';
                        itemDiv.innerHTML = `
                            <div class="flex items-center space-x-4">
                                <!-- Minimal Placeholder Icon -->
                                <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center text-indigo-600 font-bold text-xs">${item.name.charAt(0)}</div>
                                <div>
                                    <p class="font-semibold text-gray-800">${item.name}</p>
                                    <p class="text-sm text-gray-500">${formatCurrency(item.price)} x ${item.quantity}</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <span class="font-bold text-gray-900">${formatCurrency(itemTotal)}</span>
                                <button class="remove-item-btn text-red-500 hover:text-red-700 p-1 rounded-full bg-red-50" data-doc-id="${item.docId}">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div>
                        `;
                        elements.cartItemsContainer.appendChild(itemDiv);
                    });
                    elements.checkoutBtn.disabled = false;
                }
                
                elements.cartCount.textContent = cartItems.reduce((sum, item) => sum + item.quantity, 0);
                elements.cartTotal.textContent = formatCurrency(total);
                attachCartListeners();
            };

            // --- DATA / FIRESTORE FUNCTIONS ---

            const seedProducts = async () => {
                const initialProducts = [
                    { name: 'Quantum Processor', description: 'Next-gen silicon for unparalleled speed and efficiency.', price: 999.99 },
                    { name: 'Holo-Display 27"', description: 'Immersive holographic experience with 8K resolution.', price: 1499.00 },
                    { name: 'Ergo-Keyboard 5000', description: 'Silent, mechanical, and designed for maximum comfort.', price: 129.50 },
                    { name: 'Nano-Drone Scout', description: 'Pocket-sized drone with 4K camera and 30-minute flight time.', price: 349.95 }
                ];
                
                const productsCollection = window.collection(window.db, window.getProductsPath());
                
                for (const product of initialProducts) {
                    // Check if product already exists to prevent duplicates
                    const q = window.query(productsCollection, window.where('name', '==', product.name));
                    const snapshot = await window.getDocs(q);
                    
                    if (snapshot.empty) {
                        await window.addDoc(productsCollection, product);
                    }
                }
            };

            const setupProductListener = () => {
                const productsCollection = window.collection(window.db, window.getProductsPath());
                window.onSnapshot(productsCollection, (snapshot) => {
                    products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderProducts();
                    if (products.length === 0) {
                        seedProducts().then(() => console.log("Seeding complete.")).catch(showError);
                    }
                }, (error) => {
                    showError(`Failed to load products: ${error.message}`);
                });
            };

            const setupCartListener = () => {
                const cartCollection = window.collection(window.db, window.getCartPath());
                window.onSnapshot(cartCollection, (snapshot) => {
                    cartItems = snapshot.docs.map(doc => ({ 
                        docId: doc.id, 
                        ...doc.data() 
                    }));
                    renderCart();
                }, (error) => {
                    showError(`Failed to load cart: ${error.message}`);
                });
            };

            const addToCart = async (productId) => {
                if (!window.db || !window.userId) return;

                const product = products.find(p => p.id === productId);
                if (!product) {
                    showError("Product not found.");
                    return;
                }

                const cartCollection = window.collection(window.db, window.getCartPath());
                
                // Check if item already exists in cart
                const existingItem = cartItems.find(item => item.id === productId);

                try {
                    if (existingItem) {
                        // Update quantity
                        const docRef = window.doc(cartCollection, existingItem.docId);
                        await window.updateDoc(docRef, { 
                            quantity: existingItem.quantity + 1 
                        });
                    } else {
                        // Add new item
                        await window.addDoc(cartCollection, {
                            id: product.id,
                            name: product.name,
                            price: product.price,
                            quantity: 1,
                            addedAt: new Date()
                        });
                    }
                } catch (e) {
                    showError(`Failed to add item to cart: ${e.message}`);
                }
            };

            const removeItemFromCart = async (docId) => {
                if (!window.db || !window.userId) return;
                
                try {
                    const docRef = window.doc(window.db, window.getCartPath(), docId);
                    await window.deleteDoc(docRef);
                } catch (e) {
                    showError(`Failed to remove item: ${e.message}`);
                }
            };

            const checkout = async () => {
                if (!window.db || !window.userId || cartItems.length === 0) return;

                try {
                    // 1. Simulate Order Processing (e.g., save order history)
                    const orderHistoryCollection = window.collection(window.db, `artifacts/${window.__app_id}/users/${window.userId}/order_history`);
                    const order = {
                        items: cartItems.map(item => ({ name: item.name, price: item.price, quantity: item.quantity })),
                        total: cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0),
                        timestamp: new Date()
                    };
                    await window.addDoc(orderHistoryCollection, order);
                    console.log("Order saved to history.");

                    // 2. Clear the cart (Order Processing Complete)
                    // Use Promise.all for efficient batch deletion
                    const deletePromises = cartItems.map(item => 
                        window.deleteDoc(window.doc(window.db, window.getCartPath(), item.docId))
                    );
                    await Promise.all(deletePromises);
                    
                    hideCartModal();
                    showConfirmationModal();

                } catch (e) {
                    showError(`Checkout failed: ${e.message}`);
                }
            };

            // --- EVENT LISTENERS ---

            const attachProductListeners = () => {
                document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                    button.onclick = (e) => {
                        const productId = e.currentTarget.dataset.id;
                        addToCart(productId);
                    };
                });
            };

            const attachCartListeners = () => {
                document.querySelectorAll('.remove-item-btn').forEach(button => {
                    button.onclick = (e) => {
                        const docId = e.currentTarget.dataset.docId;
                        removeItemFromCart(docId);
                    };
                });
            };

            const attachGlobalListeners = () => {
                elements.cartBtn.onclick = showCartModal;
                elements.closeCartBtn.onclick = hideCartModal;
                elements.checkoutBtn.onclick = checkout;
                elements.closeConfirmationBtn.onclick = hideConfirmationModal;
            };

            // --- APPLICATION INITIALIZATION ---

            window.initApp = () => {
                if (window.userId) {
                    elements.userIdDisplay.textContent = `User: ${window.userId}`;
                }
                
                // Initialize listeners for both products (public) and cart (private) data
                setupProductListener(); 
                setupCartListener();
                attachGlobalListeners();
            };

            // If auth is already ready (in case of a race condition), call initApp directly
            if (window.isAuthReady) {
                window.initApp();
            }

        })();
    </script>
</body>
</html>
